<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consultation & Payment - PharmaLogic</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- HEADER -->
  <div class="bg-green-900 text-white px-6 py-4 flex items-center justify-between shadow-md">
    <a href="index.html"><img src="logo.jpeg" alt="PharmaLogic Logo" class="h-10" /></a>
    <a href="index.html" class="bg-white text-blue-900 font-semibold px-4 py-2 rounded hover:bg-gray-100">Home</a>
  </div>

  <!-- FORM -->
  <div class="max-w-4xl mx-auto p-6 bg-white shadow-md mt-10 rounded-lg">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-800">Start Consultation & Payment</h1>

    <form id="consultation-form">
    <!-- Step 1: Consultation & Medical Info -->
      <fieldset id="step-1">
        <legend class="font-bold mb-4 text-xl text-gray-700">Patient Consultation & Medical History</legend>

        <!-- Patient Info -->
        <label class="block mb-3">
          Full Name*:
          <input type="text" name="patient_name" required class="border p-2 w-full rounded" />
        </label>
        <label class="block mb-3">
          Date of Birth*:
          <input type="date" name="dob" required class="border p-2 w-full rounded" />
        </label>
        
        <label class="block mb-3">
           Are you on mounjaro or not?*:
          <select name="Are you on mounjaro or not" required class="border p-2 w-full rounded">
            <option value="">Select...</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>        
        <!-- Medical Screening -->
        <label class="block mb-3">
          Weight (kg)*:
          <input type="number" name="weight" id="weight" step="0.1" required class="border p-2 w-full rounded" />
        </label>
        <label class="block mb-3">
          Height (cm)*:
          <input type="number" name="height" id="height" step="0.1" required class="border p-2 w-full rounded" />
        </label>
        <label class="block mb-3">
          Calculated BMI:
          <input type="text" id="bmi" name="bmi" readonly class="border p-2 w-full rounded bg-gray-100" />
        </label>

        <label class="block mb-3">
          Do you have a BMI over 30, or over 27?*
          <select name="bmi_criteria" required class="border p-2 w-full rounded">
            <option value="">Select...</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>

        <label class="block mb-3">
          Do you have diabetes?*
          <select name="t2d" required class="border p-2 w-full rounded">
            <option value="">Select...</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>

        <label class="block mb-3">
          Are you currently pregnant, breastfeeding, or planning to become pregnant?*
          <select name="pregnancy" required class="border p-2 w-full rounded">
            <option value="">Select...</option>
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
        </label>

        <label class="block mb-3">
          Do you have any of the following conditions? (tick all that apply)
          <div class="mt-1 space-y-1 text-sm">
            <label><input type="checkbox" name="conditions" value="Thyroid cancer" /> Thyroid cancer (personal or family history)</label><br />
            <label><input type="checkbox" name="conditions" value="Pancreatitis" /> Pancreatitis</label><br />
            <label><input type="checkbox" name="conditions" value="Kidney/liver disease" /> Kidney or liver disease</label><br />
            <label><input type="checkbox" name="conditions" value="Eating disorder" /> History of eating disorder</label><br />
            <label><input type="checkbox" name="conditions" value="None" /> None</label>
          </div>
        </label>

        <label class="block mb-3">
          Are you currently taking any medications? If yes, please list them:
          <textarea name="medications" class="border p-2 w-full rounded"></textarea>
        </label>

        <!-- Mounjaro Strength & Uploads -->
        <label class="block mb-3 font-semibold">
          Which strength of Mounjaro are you looking for?*
          <select name="mounjaro_strength" id="mounjaro_strength" required class="border p-2 w-full rounded">
            <option value="">Select one</option>
            <option value="2.5mg">2.5mg</option>
            <option value="5mg">5mg</option>
            <option value="7.5mg">7.5mg</option>
            <option value="10mg">10mg</option>
            <option value="12.5mg">12.5mg</option>
            <option value="15mg">15mg</option>
          </select>
        </label>

        <div id="proof-id" class="mb-4 hidden">
          <label class="block mb-2 font-semibold">Upload Valid Proof of ID</label>
          <input type="file" name="proof_of_id" class="w-full" />
        </div>
        <div id="prescription-div" class="mb-4 hidden">
          <label class="block mb-2 font-semibold">Upload Previous Prescription</label>
          <input type="file" name="previous_prescription" class="w-full" />
        </div>
        <div id="video-div" class="mb-4 hidden">
          <label class="block mb-2 font-semibold">Upload a short video (on scale & verification)</label>
          <input type="file" name="video_upload" accept="video/*" class="w-full" />
        </div>

        <button type="button" id="to-step-2" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold mt-4">Next: Billing & Shipping</button>
      </fieldset>

      <!-- Step 2: Billing & Shipping -->
     <fieldset id="step-2" class="hidden">
  <legend class="font-bold mb-4 text-xl text-gray-700">Billing & Shipping Address</legend>

  <h3 class="font-semibold mb-2">Billing Address</h3>
  <label class="block mb-3">
    Address Line 1*:
    <input type="text" name="billing_address_1" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Address Line 2:
    <input type="text" name="billing_address_2" class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    City*:
    <input type="text" name="billing_city" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    State/Region*:
    <input type="text" name="billing_state" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Postcode*:
    <input type="text" name="billing_postcode" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Country*:
    <input type="text" name="billing_country" required class="border p-2 w-full rounded" />
  </label>

  <label class="block mb-3">
    Mobile Number* (UK format: +44XXXXXXXXXX):
    <input type="tel" name="billing_phone" id="billing-phone" required pattern="^\+44\d{10}$" class="border p-2 w-full rounded" placeholder="+441234567890" />
    <p id="billing-phone-error" class="text-red-600 text-sm mt-1 hidden">Invalid UK phone number format. Use +44 followed by 10 digits.</p>
  </label>

  <label class="block mb-3">
    Email Address*:
    <input type="email" name="billing_email" id="billing-email" required class="border p-2 w-full rounded" />
  </label>

  <h3 class="font-semibold mt-6 mb-2">Shipping Address</h3>
  <label class="block mb-3">
    Address Line 1*:
    <input type="text" name="shipping_address_1" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Address Line 2:
    <input type="text" name="shipping_address_2" class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    City*:
    <input type="text" name="shipping_city" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    State/Region*:
    <input type="text" name="shipping_state" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Postcode*:
    <input type="text" name="shipping_postcode" required class="border p-2 w-full rounded" />
  </label>
  <label class="block mb-3">
    Country*:
    <input type="text" name="shipping_country" required class="border p-2 w-full rounded" />
  </label>

  <div class="mt-6">
    <button type="button" id="back-to-step-1" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded font-semibold mr-4">Back</button>
    <button type="button" id="to-step-3" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold">Next: Review & Pay</button>
  </div>
</fieldset>

      <!-- Step 3: Review & Payment -->
<fieldset id="step-3" class="hidden">
  <legend class="font-bold mb-4 text-xl text-gray-700">Review & Payment</legend>

  <!-- Summary display -->
  <div id="review-summary" class="mb-6 bg-gray-50 border p-4 rounded max-h-96 overflow-y-auto">
    <!-- Populated by JS -->
  </div>

  <!-- Payment error (for future use) -->
  <div id="payment-error" class="text-red-600 mb-4 hidden"></div>

  <!-- Navigation -->
  <button type="button" id="back-to-step-2" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded font-semibold mr-4">
    Back
  </button>
  <button type="submit" id="pay-button" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold">
    Submit & Pay
  </button>
</fieldset>

    </form>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('consultation-form');
  if (!form) return;

  // BMI Live Calculation
  const weightInput = document.getElementById('weight');
  const heightInput = document.getElementById('height');
  const bmiOutput = document.getElementById('bmi');

  function calculateBMI() {
    const weight = parseFloat(weightInput.value);
    const heightCm = parseFloat(heightInput.value);
    if (!weight || !heightCm || heightCm <= 0) {
      bmiOutput.value = '';
      return;
    }

    const heightM = heightCm / 100;
    const bmi = weight / (heightM * heightM);
    bmiOutput.value = bmi.toFixed(1);
  }

  weightInput.addEventListener('input', calculateBMI);
  heightInput.addEventListener('input', calculateBMI);

  // Navigation elements
  const toStep2Btn = document.getElementById('to-step-2');
  const toStep3Btn = document.getElementById('to-step-3');
  const step1 = document.getElementById('step-1');
  const step2 = document.getElementById('step-2');
  const step3 = document.getElementById('step-3');

  function validatePhone() {
    return true; // Placeholder — extend as needed
  }

  // ✅ Review Summary Generator
  function populateReview() {
    const reviewDiv = document.getElementById('review-summary');
    const formData = new FormData(form);
    let html = '<h3 class="font-semibold mb-2">Review Your Details</h3><ul class="list-disc pl-5 space-y-2">';

    for (const [key, value] of formData.entries()) {
      if (
        key === "proof_of_id" ||
        key === "previous_prescription" ||
        key === "video_upload"
      ) continue;
      if (!value) continue;

      const label = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
      html += `<li><strong>${label}:</strong> ${value}</li>`;
    }

    html += '</ul>';
    reviewDiv.innerHTML = html;
  }

  if (toStep2Btn) {
    toStep2Btn.addEventListener('click', () => {
      if (!form?.checkValidity?.() || !validatePhone()) {
        form?.reportValidity?.();
        return;
      }
      if (step1 && step2) {
        step1.classList.add('hidden');
        step2.classList.remove('hidden');
      }
      window.scrollTo(0, 0);
    });
  }

  if (toStep3Btn) {
    toStep3Btn.addEventListener('click', () => {
      if (!form?.checkValidity?.()) {
        form?.reportValidity?.();
        return;
      }
      populateReview();
      if (step2 && step3) {
        step2.classList.add('hidden');
        step3.classList.remove('hidden');
      }
      window.scrollTo(0, 0);
    });
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (!form?.checkValidity?.() || !validatePhone()) {
      form?.reportValidity?.();
      return;
    }
    alert('Form submitted successfully! Redirecting to payment...');
    window.location.href = "https://buy.stripe.com/test_8wM6qt99m4Hv2zO3cc";
  });

  // ✅ Billing Phone Validation Logic
  const billingPhoneInput = document.getElementById('billing-phone');
  const billingPhoneError = document.getElementById('billing-phone-error');

  if (billingPhoneInput && billingPhoneError) {
    billingPhoneInput.addEventListener('input', () => {
      const valid = /^\+44\d{10}$/.test(billingPhoneInput.value.trim());
      billingPhoneInput.setCustomValidity(valid ? "" : "Invalid UK phone number.");
      billingPhoneError.classList.toggle('hidden', valid);
    });
  }
});
</script>

  
