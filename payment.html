<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PharmaLogic - Secure Payment</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.12);
    }
    h1, h2 { color: #333; }
    .btn {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
      width: 100%;
    }
    .btn:hover { background-color: #0d5ec7; }
    .info-box {
      background: #eef6ff;
      padding: 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      border-left: 4px solid #1a73e8;
    }
  </style>
</head>

<body>
  <div class="container">
    
    <h1>Mounjaro Weight Loss Injection</h1>
    <p><strong>Price:</strong> ¬£125.00</p>

    <div id="order-box" class="info-box">
      Retrieving your consultation details...
    </div>

    <h2 class="mt-4">Complete Payment</h2>
    <p>Click below to go to our secure payment portal.</p>

    <button id="pay-now" class="btn">Pay Securely</button>

    <p id="status-message" style="margin-top:1rem;"></p>

  </div>

<script>
  // Read ORDER ID from URL:
  const params = new URLSearchParams(window.location.search);
  const orderId = params.get("order_id");

  const orderBox = document.getElementById("order-box");
  const payButton = document.getElementById("pay-now");
  const statusMessage = document.getElementById("status-message");

  if (!orderId) {
    orderBox.innerHTML = "<span style='color:red'>‚ùå Error: Missing order ID.</span>";
    payButton.disabled = true;
  } else {
    orderBox.innerHTML = `
      <strong>Order ID:</strong> ${orderId}<br>
      Your consultation was submitted successfully.<br>
      Please proceed to secure payment.
    `;
  }

  /**********************
   * PAYMENT BUTTON CLICK
   **********************/
  payButton.addEventListener("click", async () => {

    statusMessage.innerText = "Redirecting to payment...";
    statusMessage.style.color = "black";

    // üëâ Redirect customer to Stripe Checkout
    window.location.href = "https://buy.stripe.com/test_14A00lcfU1gH7b838k3cc00";

    // OPTIONAL: If you want to mark order as paid only AFTER Stripe returns
    // We can handle a success URL later.

    // üëâ Mark order as PAID in your backend
    try {
      await fetch("/api/update-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          order_id: orderId,
          status: "Paid"
        })
      });

      statusMessage.innerText = "‚úì Payment recorded. Redirecting...";
      statusMessage.style.color = "green";

      setTimeout(() => {
        window.location.href = "order-success.html?order_id=" + orderId;
      }, 1500);

    } catch (error) {
      statusMessage.innerText = "‚ùå Error updating payment status.";
      statusMessage.style.color = "red";
    }
  });
</script>

</body>
</html>
